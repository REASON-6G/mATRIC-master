---
- hosts: localhost
  vars:
    emulator_script: "/path/to/5g_emulator.py"  # Path to the 5G emulator Python script
  tasks:
    - name: Display the emulator details
      debug:
        msg: |
          Spinning up {{ num_access_points }} 5G access points.
          Locations: {{ locations }}
          Devices per access point: {{ num_devices }}
          Emulation duration: {{ duration }} seconds

    - name: Spin up 5G access points
      shell: |
        for i in $(seq 1 {{ num_access_points }}); do
          echo "Starting 5G emulator $i on location {{ locations[i|int - 1] }}"
          python {{ emulator_script }} --location {{ locations[i|int - 1] }} --devices {{ num_devices }} --duration {{ duration }} &
        done
      async: "{{ duration + 60 }}"  # Allow playbook to run longer than the emulation
      poll: 0
      ignore_errors: yes

    - name: Wait for emulation to finish
      pause:
        seconds: "{{ duration }}"
